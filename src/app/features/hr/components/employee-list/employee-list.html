<!-- ‚ö†Ô∏è COMPONENT: HR & Departments Module Overview
     - Purpose: Display HR statistics and manage departments/employees with tabbed interface
     - No functional changes - styling updates only using Bootstrap classes
     - All data loading and tab switching logic remains intact
-->

<div class="container-fluid p-4">
  <!-- Header Section: Title and Subtitle -->
  <div class="mb-4">
    <h2 class="h3 mb-1">üë• HR & Departments Module</h2>
    <p class="text-muted small">Manage departments, employees, and attendance tracking</p>
  </div>

  <!-- Loading Alert: Display spinner while fetching data -->
  @if (isLoading()) {
    <div class="alert alert-info d-flex align-items-center" role="alert">
      <i class="bi bi-hourglass-split me-2"></i>
      <span>‚è≥ Loading HR data... Please wait.</span>
    </div>
  } 
  @else {
    <!-- Statistics Cards Section: Display key HR metrics -->
    <div class="row g-3 mb-4">
      <!-- Total Employees Card: Count of all employees in system -->
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="card-title mb-0">Total Employees</h5>
              <i class="bi bi-people-fill text-primary fs-4"></i>
            </div>
            <p class="h4 mb-2 fw-bold">{{ totalEmployees() }}</p>
            <small class="text-muted">Active staff members</small>
          </div>
        </div>
      </div>

      <!-- Total Departments Card: Count of all departments -->
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="card-title mb-0">Departments</h5>
              <i class="bi bi-building text-success fs-4"></i>
            </div>
            <p class="h4 mb-2 fw-bold">{{ totalDepartments() }}</p>
            <small class="text-muted">Organizational units</small>
          </div>
        </div>
      </div>

      <!-- Present Today Card: Employees present today -->
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="card-title mb-0">Present Today</h5>
              <i class="bi bi-check-circle text-info fs-4"></i>
            </div>
            <p class="h4 mb-2 fw-bold">{{ presentToday() }}</p>
            <small class="text-muted">Employees at work</small>
          </div>
        </div>
      </div>

      <!-- Attendance Rate Card: Percentage of attendance -->
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="card-title mb-0">Attendance Rate</h5>
              <i class="bi bi-percent text-warning fs-4"></i>
            </div>
            <p class="h4 mb-2 fw-bold">{{ attendanceRate() }}%</p>
            <small class="text-success"><i class="bi bi-arrow-up"></i> 2.4% vs last month</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Navigation: Switch between Departments and Employees -->
    <div class="mb-4">
      <ul class="nav nav-tabs border-bottom" role="tablist">
        <!-- Departments Tab -->
        <li class="nav-item" role="presentation">
          <button 
            class="nav-link"
            [class.active]="activeTab() === 'departments'"
            (click)="setActiveTab('departments')"
            type="button"
            role="tab"
          >
            <i class="bi bi-building me-2"></i> Departments
          </button>
        </li>

        <!-- Employees Tab -->
        <li class="nav-item" role="presentation">
          <button 
            class="nav-link"
            [class.active]="activeTab() === 'employees'"
            (click)="setActiveTab('employees')"
            type="button"
            role="tab"
          >
            <i class="bi bi-people me-2"></i> Employees
          </button>
        </li>
      </ul>
    </div>

    <!-- DEPARTMENTS TAB CONTENT -->
    @if (activeTab() === 'departments') {
      <div class="tab-pane active">
        <!-- Departments Section Header: Title and Add Department button -->
        <div class="d-flex align-items-center justify-content-between mb-4">
          <div>
            <h4 class="mb-0">Department Directory</h4>
            <p class="text-muted small">All organizational units and their details</p>
          </div>
          <button class="btn btn-primary" routerLink="/hr/create-department">
            <i class="bi bi-plus-circle me-2"></i> Add Department
          </button>
        </div>

        <!-- Departments Grid: Display departments as cards -->
        <div class="row g-3">
          @for (dept of departments(); track dept.id) {
            <div class="col-12 col-md-6 col-lg-4">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <!-- Department Header: Name and Code -->
                  <div class="d-flex align-items-start justify-content-between mb-3">
                    <div>
                      <h5 class="card-title mb-1">{{ dept.name }}</h5>
                      <small class="text-muted">{{ dept.code }}</small>
                    </div>
                    <i class="bi bi-building text-primary fs-5"></i>
                  </div>

                  <!-- Department Description -->
                  <p class="card-text text-muted small mb-3">
                    {{ dept.description || 'No description provided' }}
                  </p>

                  <!-- Employee Count for this Department -->
                  <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                    <span class="badge bg-light text-dark">
                      {{ getEmployeeCountByDepartment(dept.id) }} employees
                    </span>
                    <button class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-pencil me-1"></i> Edit
                    </button>
                  </div>
                </div>
              </div>
            </div>
          }

          @empty {
            <!-- Empty State: No departments found -->
            <div class="col-12">
              <div class="text-center py-5 text-muted">
                <i class="bi bi-inbox fs-1 mb-3"></i>
                <p>No departments found.</p>
                <button class="btn btn-sm btn-primary" routerLink="/hr/create-department">
                  <i class="bi bi-plus-circle me-2"></i> Create First Department
                </button>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- EMPLOYEES TAB CONTENT -->
    @if (activeTab() === 'employees') {
      <div class="tab-pane active">
        <!-- Employees Section Header: Title and Add Employee button -->
        <div class="d-flex align-items-center justify-content-between mb-4">
          <div>
            <h4 class="mb-0">Employee Directory</h4>
            <p class="text-muted small">All employees with their details and contact information</p>
          </div>
          <button class="btn btn-primary" routerLink="/hr/create-employee">
            <i class="bi bi-person-plus me-2"></i> Add Employee
          </button>
        </div>

        <!-- Employees Table: Responsive Bootstrap table -->
        <div class="table-responsive">
          <table class="table table-hover table-striped align-middle">
            <thead class="table-light">
              <tr>
                <th>Name</th>
                <th>Job Title</th>
                <th>Department</th>
                <th>Email</th>
                <th>Phone</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Loop through all employees -->
              @for (emp of employees(); track emp.id) {
                <tr>
                  <!-- Employee Name -->
                  <td><strong>{{ emp.fullName }}</strong></td>
                  
                  <!-- Job Title -->
                  <td>{{ emp.jobTitle }}</td>
                  
                  <!-- Department Badge -->
                  <td>
                    <span class="badge bg-info text-dark">
                      {{ emp.departmentName || 'N/A' }}
                    </span>
                  </td>
                  
                  <!-- Email -->
                  <td>{{ emp.email }}</td>
                  
                  <!-- Phone -->
                  <td>{{ emp.phoneNumber }}</td>
                  
                  <!-- Action Buttons -->
                  <td class="text-center">
                    <button class="btn btn-sm btn-outline-primary" title="Edit employee">
                      <i class="bi bi-pencil"></i>
                    </button>
                  </td>
                </tr>
              }

              @empty {
                <!-- Empty State: No employees found -->
                <tr>
                  <td colspan="6" class="text-center py-4 text-muted">
                    <i class="bi bi-inbox me-2"></i> No employees found.
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }
  }
</div>