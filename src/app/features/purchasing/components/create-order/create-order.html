<div class="container">
  <h2>ğŸ›’ Create Purchase Order</h2>

  <form [formGroup]="orderForm" (ngSubmit)="onSubmit()" class="order-form">
    
    <div class="form-section">
      <h3>1. Order Details</h3>
      <div class="row">
        <div class="form-group">
          <label>Supplier:</label>
          <select formControlName="supplierId">
            <option value="">-- Select Supplier --</option>
            @for (sup of suppliers(); track sup.id) {
              <option [value]="sup.id">{{ sup.supplierName }}</option>
            }
          </select>
        </div>

        <div class="form-group">
          <label>Expected Delivery:</label>
          <input type="date" formControlName="expectedDeliveryDate">
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="section-header">
        <h3>2. Order Items</h3>
        <button type="button" class="btn-add" (click)="addItem()">+ Add Item</button>
      </div>

      <table class="items-table">
        <thead>
          <tr>
            <th>Material</th>
            <th width="100">Qty</th>
            <th width="150">Unit Price</th>
            <th width="100">Total</th>
            <th width="50"></th>
          </tr>
        </thead>
        <tbody formArrayName="items">
          @for (item of itemsArray.controls; track $index) {
            <tr [formGroupName]="$index">
              <td>
                <select formControlName="materialId">
                  <option value="">-- Select Material --</option>
                  @for (mat of materials(); track mat.id) {
                    <option [value]="mat.id">{{ mat.materialName }}</option>
                  }
                </select>
              </td>
              <td>
                <input type="number" formControlName="quantity" min="1">
              </td>
              <td>
                <input type="number" formControlName="unitPrice" min="0">
              </td>
              <td>
                {{ (item.get('quantity')?.value * item.get('unitPrice')?.value) | currency }}
              </td>
              <td>
                <button type="button" class="btn-remove" (click)="removeItem($index)" title="Remove">ğŸ—‘ï¸</button>
              </td>
            </tr>
          }
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" style="text-align: right; font-weight: bold;">Grand Total:</td>
            <td style="font-weight: bold; color: #0055ff;">{{ totalAmount | currency }}</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="actions">
      <button type="button" class="btn-secondary" routerLink="/purchasing">Cancel</button>
      <button type="submit" class="btn-primary" [disabled]="isSubmitting()">
        @if (isSubmitting()) { Processing... } @else { ğŸš€ Submit Order }
      </button>
    </div>

  </form>
</div>