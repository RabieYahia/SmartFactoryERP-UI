<!-- âš ï¸ NOTE: Purchase order creation form uses Bootstrap components.
     No functional changes - styling updates only. All calculation logic remains intact.
-->

<div class="container-fluid p-4">
  <div class="mb-4">
    <h2 class="h3">ðŸ›’ Create Purchase Order</h2>
  </div>

  <div class="row">
    <div class="col-12">
      <form [formGroup]="orderForm" (ngSubmit)="onSubmit()" class="card border-0 shadow-sm">
        <div class="card-body">
          
          <!-- Section 1: Order Details -->
          <div class="mb-4">
            <h5 class="card-title mb-3">1. Order Details</h5>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="supplierId" class="form-label">Supplier</label>
                <select class="form-select" id="supplierId" formControlName="supplierId">
                  <option value="">-- Select Supplier --</option>
                  @for (sup of suppliers(); track sup.id) {
                    <option [value]="sup.id">{{ sup.supplierName }}</option>
                  }
                </select>
              </div>

              <div class="col-md-6 mb-3">
                <label for="expectedDeliveryDate" class="form-label">Expected Delivery</label>
                <input 
                  type="date" 
                  class="form-control" 
                  id="expectedDeliveryDate"
                  formControlName="expectedDeliveryDate"
                >
              </div>
            </div>
          </div>

          <!-- Section 2: Order Items -->
          <div class="mb-4">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="card-title mb-0">2. Order Items</h5>
              <button type="button" class="btn btn-sm btn-outline-primary" (click)="addItem()">
                <i class="bi bi-plus-circle me-2"></i> Add Item
              </button>
            </div>

            <!-- Items Table -->
            <div class="table-responsive">
              <table class="table table-sm table-bordered align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Material</th>
                    <th style="width: 100px;">Qty</th>
                    <th style="width: 150px;">Unit Price</th>
                    <th style="width: 100px;">Total</th>
                    <th style="width: 60px;"></th>
                  </tr>
                </thead>
                <tbody formArrayName="items">
                  @for (item of itemsArray.controls; track $index) {
                    <tr [formGroupName]="$index">
                      <td>
                        <select class="form-select form-select-sm" formControlName="materialId">
                          <option value="">-- Select Material --</option>
                          @for (mat of materials(); track mat.id) {
                            <option [value]="mat.id">{{ mat.materialName }}</option>
                          }
                        </select>
                      </td>
                      <td>
                        <input 
                          type="number" 
                          class="form-control form-control-sm" 
                          formControlName="quantity" 
                          min="1"
                        >
                      </td>
                      <td>
                        <input 
                          type="number" 
                          class="form-control form-control-sm" 
                          formControlName="unitPrice" 
                          min="0"
                        >
                      </td>
                      <td class="text-end fw-bold text-primary">
                        {{ (item.get('quantity')?.value * item.get('unitPrice')?.value) | currency }}
                      </td>
                      <td class="text-center">
                        <button type="button" class="btn btn-sm btn-outline-danger" (click)="removeItem($index)" title="Remove">
                          <i class="bi bi-trash"></i>
                        </button>
                      </td>
                    </tr>
                  }
                </tbody>
                <tfoot>
                  <tr class="table-light fw-bold">
                    <td colspan="3" class="text-end">Grand Total:</td>
                    <td class="text-primary">{{ totalAmount | currency }}</td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <!-- Form actions -->
          <div class="d-flex gap-2 justify-content-end">
            <button type="button" class="btn btn-outline-secondary" routerLink="/purchasing">
              <i class="bi bi-x-circle me-2"></i> Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="isSubmitting()">
              @if (isSubmitting()) { 
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                Processing... 
              } @else { 
                <i class="bi bi-check-circle me-2"></i> Submit Order
              }
            </button>
          </div>

        </div>
      </form>
    </div>
  </div>
</div>