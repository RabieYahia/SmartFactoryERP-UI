<div class="container-fluid p-4">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="h3 fw-bold text-primary mb-1">ðŸ“„ Order Details <span class="text-muted">#{{ order()?.poNumber }}</span></h2>
      <p class="text-muted small">Review items before confirming the order.</p>
    </div>
    <button class="btn btn-outline-secondary" routerLink="/purchasing/orders">
      <i class="bi bi-arrow-left me-2"></i> Back to List
    </button>
  </div>

  @if (isLoading()) {
    <div class="alert alert-info"><i class="bi bi-hourglass-split me-2"></i> Loading details...</div>
  } @else {

    <div class="card border-0 shadow-sm mb-4">
      <div class="card-body">
        <div class="row">
          <div class="col-md-3 border-end">
            <label class="text-muted small text-uppercase fw-bold">Supplier</label>
            <p class="fw-bold fs-5 mb-0 text-primary">{{ order()?.supplierName }}</p>
          </div>
          <div class="col-md-3 border-end">
            <label class="text-muted small text-uppercase fw-bold">Date</label>
            <p class="fw-bold fs-5 mb-0">{{ order()?.orderDate | date:'mediumDate' }}</p>
          </div>
          <div class="col-md-3 border-end">
            <label class="text-muted small text-uppercase fw-bold">Delivery Date</label>
            <p class="fw-bold fs-5 mb-0">{{ order()?.expectedDeliveryDate | date:'mediumDate' }}</p>
          </div>
          <div class="col-md-3">
            <label class="text-muted small text-uppercase fw-bold">Status</label>
            <div>
              <span class="badge px-3 py-2 rounded-pill"
                [class.bg-warning]="order()?.status === 'Draft'"
                [class.bg-success]="order()?.status === 'Confirmed'"
                [class.bg-info]="order()?.status === 'Received'">
                {{ order()?.status }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white py-3">
        <h6 class="mb-0 fw-bold"><i class="bi bi-box-seam me-2"></i>Ordered Items</h6>
      </div>
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="bg-light">
            <tr>
              <th>Material Name</th>
              <th>Code</th>
              <th class="text-center">Quantity</th>
              <th class="text-end">Unit Price</th>
              <th class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
            @for (item of order()?.items; track item.id) {
              <tr>
                <td class="fw-bold">{{ item.materialName }}</td>
                <td class="text-muted small">{{ item.materialCode }}</td>
                <td class="text-center"><span class="badge bg-light text-dark border">{{ item.quantity }}</span></td>
                <td class="text-end">{{ item.unitPrice | currency }}</td>
                <td class="text-end fw-bold text-primary">{{ (item.quantity * item.unitPrice) | currency }}</td>
              </tr>
            }
          </tbody>
          <tfoot class="bg-light">
            <tr>
              <td colspan="4" class="text-end fw-bold text-uppercase text-muted">Grand Total:</td>
              <td class="text-end fw-bold fs-4 text-success">{{ order()?.totalAmount | currency }}</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <div class="d-flex justify-content-end gap-2 pt-2">
      @if (order()?.status === 'Draft') {
        <button class="btn btn-success btn-lg px-5 shadow-sm" (click)="confirmOrder()">
          <i class="bi bi-check-circle-fill me-2"></i> Confirm Order
        </button>
      }

      @if (order()?.status === 'Confirmed') {
        <button class="btn btn-info text-white btn-lg px-5 shadow-sm" [routerLink]="['/purchasing/receive', order()?.id]">
          <i class="bi bi-box-arrow-in-down me-2"></i> Receive Items
        </button>
      }
    </div>

  }
</div>
