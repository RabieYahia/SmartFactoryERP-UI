<div class="container">
  
  <div class="header-actions" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <div>
      <h2>ğŸ“œ Define Production Recipe (BOM)</h2>
      <p class="subtitle" style="margin: 0;">Link a raw material to a finished product.</p>
    </div>
    <button class="btn-secondary" routerLink="/production/orders" style="padding: 10px 15px; border-radius: 5px; cursor: pointer;">
      ğŸ­ View Factory Orders
    </button>
  </div>

  <form [formGroup]="bomForm" (ngSubmit)="onSubmit()" class="bom-card">
    
    <div class="form-group">
      <label>ğŸ”¨ Finished Product (What to make?)</label>
      <select formControlName="productId">
        <option value="">-- Select Product --</option>
        @for (mat of materials(); track mat.id) {
          <option [value]="mat.id">{{ mat.materialName }} (Stock: {{ mat.currentStockLevel }})</option>
        }
      </select>
      @if (bomForm.get('productId')?.invalid && bomForm.get('productId')?.touched) {
        <small style="color: red;">Product selection is required.</small>
      }
    </div>

    <div class="form-group">
      <label>ğŸªµ Component Material (What to use?)</label>
      <select formControlName="componentId">
        <option value="">-- Select Raw Material --</option>
        @for (mat of materials(); track mat.id) {
          <option [value]="mat.id">{{ mat.materialName }}</option>
        }
      </select>
      @if (bomForm.get('componentId')?.invalid && bomForm.get('componentId')?.touched) {
        <small style="color: red;">Component selection is required.</small>
      }
    </div>

    <div class="form-group">
      <label>âš–ï¸ Quantity Needed</label>
      <input type="number" formControlName="quantity" step="0.1">
      <small>How much of the component is needed for 1 unit of the product?</small>
      
      @if (bomForm.get('quantity')?.invalid && bomForm.get('quantity')?.touched) {
        <small style="color: red;">Quantity must be greater than 0.</small>
      }
    </div>

    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button type="button" class="btn-secondary" routerLink="/dashboard" style="flex: 1; padding: 15px; border-radius: 6px; cursor: pointer; background: #eee; border: none;">
        Cancel
      </button>

      <button type="submit" class="btn-primary" [disabled]="isSubmitting()" style="flex: 2;">
        @if (isSubmitting()) { Saving... } @else { ğŸ”— Link Materials }
      </button>
    </div>

  </form>
</div>