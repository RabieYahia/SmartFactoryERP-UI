<div class="container-fluid p-4">
  <div class="d-flex align-items-center justify-content-between mb-4">
    <div>
      <h2 class="h3 mb-1">üè≠ Production Orders</h2>
      <p class="text-muted small">Manage production work orders and track manufacturing status</p>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary" routerLink="/production" title="Back to Dashboard">
        <i class="bi bi-arrow-left me-2"></i> Dashboard
      </button>
      <button class="btn btn-primary" routerLink="/production/create-order" title="Create new production order">
        <i class="bi bi-plus-circle me-2"></i> New Order
      </button>
    </div>
  </div>

  @if (isLoading()) {
    <div class="alert alert-info d-flex align-items-center" role="alert">
      <i class="bi bi-hourglass-split me-2"></i>
      <span>‚è≥ Loading production orders... Please wait.</span>
    </div>
  }
  @else {
    <div class="table-responsive">
      <table class="table table-hover table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th>Order #</th>
            <th>Product</th>
            <th>Quantity</th>
            <th>Start Date</th>
            <th>Status</th>
            <th class="text-end pe-4">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (order of orders(); track order.id) {
            <tr>
              <td><strong>{{ order.orderNumber || '#' + order.id }}</strong></td>
              <td>{{ order.productName }}</td>
              <td class="fw-bold">{{ order.quantity }}</td>
              <td>{{ order.startDate | date:'mediumDate' }}</td>
              <td>
                <span class="badge"
                      [class.bg-secondary]="order.status === 'Planned' || order.status === 'Scheduled'"
                      [class.bg-info]="order.status === 'Started' || order.status === 'InProgress'"
                      [class.bg-success]="order.status === 'Completed'">
                  {{ order.status }}
                </span>
              </td>
              <td class="text-end pe-4">
                <div class="d-flex justify-content-end gap-2">

                  <a class="btn btn-sm btn-outline-primary" [routerLink]="['/production/orders', order.id]" title="View Details & Edit BOM">
                    <i class="bi bi-eye me-1"></i> View / Edit
                  </a>

                  @if (order.status === 'Planned' || order.status === 'Scheduled') {
                    <button class="btn btn-sm btn-warning" (click)="onStart(order.id)" title="Start Production Immediately">
                      <i class="bi bi-play-circle"></i> Start
                    </button>
                  }

                  @else if (order.status === 'Started' || order.status === 'InProgress') {
                    <button class="btn btn-sm btn-success" (click)="onComplete(order.id)" title="Complete Production">
                      <i class="bi bi-check-circle"></i> Complete
                    </button>
                  }

                  @else if (order.status === 'Completed') {
                    <span class="text-muted small fst-italic">Stored</span>
                  }
                </div>
              </td>
            </tr>
          }
          @empty {
            <tr>
              <td colspan="6" class="text-center py-5 text-muted">
                <i class="bi bi-inbox fs-1 d-block mb-3 opacity-50"></i>
                No production orders found. Create one to get started!
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
