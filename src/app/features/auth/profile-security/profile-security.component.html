<div class="profile-security-container">
  <div class="profile-security-content">
    <div class="page-header">
      <div class="header-content">
        <i class="bi bi-shield-lock-fill"></i>
        <div>
          <h1>Account Security</h1>
          <p>Manage your account security settings and monitor account activity</p>
        </div>
      </div>
      <button class="btn btn-refresh" (click)="refreshSecurityInfo()" [disabled]="isLoading()">
        <i class="bi bi-arrow-clockwise" [class.spinning]="isLoading()"></i>
        Refresh
      </button>
    </div>

    @if (isLoading()) {
      <div class="loading-state">
        <span class="spinner-border spinner-border-lg"></span>
        <p>Loading security information...</p>
      </div>
    } @else if (errorMessage()) {
      <div class="error-state">
        <i class="bi bi-exclamation-triangle-fill"></i>
        <h3>Unable to Load Security Information</h3>
        <p>{{ errorMessage() }}</p>
        <button class="btn btn-primary" (click)="refreshSecurityInfo()">
          <i class="bi bi-arrow-clockwise"></i>
          Try Again
        </button>
      </div>
    } @else if (securityInfo()) {
      <div class="security-grid">
        <!-- User Profile Card -->
        <div class="security-card profile-card">
          <div class="card-icon">
            <i class="bi bi-person-circle"></i>
          </div>
          <div class="card-content">
            <h3>Profile Information</h3>
            <div class="info-item">
              <span class="label">Full Name:</span>
              <span class="value">{{ currentUser?.fullName || 'N/A' }}</span>
            </div>
            <div class="info-item">
              <span class="label">Email:</span>
              <span class="value">{{ currentUser?.email || 'N/A' }}</span>
            </div>
            @if (currentUser?.employeeId) {
              <div class="info-item">
                <span class="label">Employee ID:</span>
                <span class="value">{{ currentUser?.employeeId }}</span>
              </div>
            }
            <div class="info-item">
              <span class="label">Roles:</span>
              <div class="roles-badges">
                @for (role of currentUser?.roles; track role) {
                  <span class="role-badge">{{ role }}</span>
                }
              </div>
            </div>
          </div>
        </div>

        <!-- Email Verification Card -->
        <div class="security-card" [class.verified]="securityInfo()?.emailConfirmed">
          <div class="card-icon" [class.success]="securityInfo()?.emailConfirmed">
            <i [class]="securityInfo()?.emailConfirmed ? 'bi bi-envelope-check-fill' : 'bi bi-envelope-x-fill'"></i>
          </div>
          <div class="card-content">
            <h3>Email Verification</h3>
            <div class="status-badge" [class.success]="securityInfo()?.emailConfirmed">
              <i [class]="securityInfo()?.emailConfirmed ? 'bi bi-check-circle-fill' : 'bi bi-x-circle-fill'"></i>
              {{ securityInfo()?.emailConfirmed ? 'Verified' : 'Not Verified' }}
            </div>
            <p class="card-description">
              @if (securityInfo()?.emailConfirmed) {
                Your email address has been verified and is secure.
              } @else {
                Please verify your email address to enhance account security.
              }
            </p>
          </div>
        </div>

        <!-- Two-Factor Authentication Card -->
        <div class="security-card" [class.verified]="securityInfo()?.twoFactorEnabled">
          <div class="card-icon" [class.success]="securityInfo()?.twoFactorEnabled">
            <i [class]="securityInfo()?.twoFactorEnabled ? 'bi bi-shield-fill-check' : 'bi bi-shield-fill-exclamation'"></i>
          </div>
          <div class="card-content">
            <h3>Two-Factor Authentication</h3>
            <div class="status-badge" [class.success]="securityInfo()?.twoFactorEnabled">
              <i [class]="securityInfo()?.twoFactorEnabled ? 'bi bi-check-circle-fill' : 'bi bi-x-circle-fill'"></i>
              {{ securityInfo()?.twoFactorEnabled ? 'Enabled' : 'Disabled' }}
            </div>
            <p class="card-description">
              @if (securityInfo()?.twoFactorEnabled) {
                2FA provides an extra layer of security for your account.
              } @else {
                Enable 2FA to add an extra layer of security to your account.
              }
            </p>
            @if (!securityInfo()?.twoFactorEnabled) {
              <button class="btn btn-secondary btn-sm" disabled>
                <i class="bi bi-plus-circle"></i>
                Enable 2FA (Coming Soon)
              </button>
            }
          </div>
        </div>

        <!-- Account Status Card -->
        <div class="security-card" [class.locked]="securityInfo()?.isLocked">
          <div class="card-icon" [class.danger]="securityInfo()?.isLocked">
            <i [class]="securityInfo()?.isLocked ? 'bi bi-lock-fill' : 'bi bi-unlock-fill'"></i>
          </div>
          <div class="card-content">
            <h3>Account Status</h3>
            <div class="status-badge" [class.danger]="securityInfo()?.isLocked" [class.success]="!securityInfo()?.isLocked">
              <i [class]="securityInfo()?.isLocked ? 'bi bi-lock-fill' : 'bi bi-check-circle-fill'"></i>
              {{ securityInfo()?.isLocked ? 'Locked' : 'Active' }}
            </div>
            @if (securityInfo()?.isLocked) {
              <p class="card-description danger">
                Your account is currently locked due to multiple failed login attempts.
              </p>
              @if (lockoutCountdown()) {
                <div class="countdown-display">
                  <i class="bi bi-clock-fill"></i>
                  <span>Unlocks in: {{ lockoutCountdown() }}</span>
                </div>
              }
            } @else {
              <p class="card-description">
                Your account is active and in good standing.
              </p>
            }
          </div>
        </div>

        <!-- Login Activity Card -->
        <div class="security-card activity-card">
          <div class="card-icon">
            <i class="bi bi-graph-up"></i>
          </div>
          <div class="card-content">
            <h3>Login Activity</h3>
            <div class="activity-stats">
              <div class="stat-item">
                <span class="stat-value">{{ securityInfo()?.accessFailedCount || 0 }}</span>
                <span class="stat-label">Failed Attempts</span>
              </div>
            </div>
            @if ((securityInfo()?.accessFailedCount || 0) > 0) {
              <div class="warning-message">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <span>Recent failed login attempts detected. Ensure your password is secure.</span>
              </div>
            }
          </div>
        </div>

        <!-- Password Management Card -->
        <div class="security-card action-card">
          <div class="card-icon">
            <i class="bi bi-key-fill"></i>
          </div>
          <div class="card-content">
            <h3>Password Management</h3>
            <p class="card-description">
              Keep your account secure by using a strong, unique password and updating it regularly.
            </p>
            <button class="btn btn-primary" (click)="navigateToChangePassword()">
              <i class="bi bi-key"></i>
              Change Password
            </button>
          </div>
        </div>
      </div>

      <!-- Security Tips -->
      <div class="security-tips">
        <h3>
          <i class="bi bi-lightbulb-fill"></i>
          Security Tips
        </h3>
        <ul>
          <li>
            <i class="bi bi-check2"></i>
            Use a strong, unique password that you don't use on other sites
          </li>
          <li>
            <i class="bi bi-check2"></i>
            Enable two-factor authentication for additional security
          </li>
          <li>
            <i class="bi bi-check2"></i>
            Never share your password or login credentials with anyone
          </li>
          <li>
            <i class="bi bi-check2"></i>
            Regularly review your account activity for suspicious behavior
          </li>
          <li>
            <i class="bi bi-check2"></i>
            Update your password if you suspect unauthorized access
          </li>
        </ul>
      </div>
    }
  </div>
</div>
