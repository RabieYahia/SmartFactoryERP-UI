<div class="container-fluid p-4">
  <div class="mb-4">
    <h2 class="h3 mb-1">üìä Dashboard Overview</h2>
    <p class="text-muted mb-0">Real-time production monitoring and business intelligence</p>
  </div>

  @if (isLoading()) {
    <div class="alert alert-info d-flex align-items-center" role="alert">
      <i class="bi bi-hourglass-split me-2"></i> 
      <span>Loading dashboard data...</span>
    </div>
  } 
  @else {
    
    <div class="row g-3 mb-4">
      <div class="col-12 col-sm-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="card-title mb-0">Total Revenue</h5>
              <i class="bi bi-cash-coin text-success fs-4"></i>
            </div>
            <p class="h4 mb-2 fw-bold">{{ stats()?.totalRevenue | currency }}</p>
            <small class="text-success">Sales Income</small>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="card-title mb-0">Total Expenses</h5>
              <i class="bi bi-wallet2 text-danger fs-4"></i>
            </div>
            <p class="h4 mb-2 fw-bold">{{ stats()?.totalExpenses | currency }}</p>
            <small class="text-danger">Operational Costs</small>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="card-title mb-0">Active Production</h5>
              <i class="bi bi-gear-wide-connected text-primary fs-4"></i>
            </div>
            <p class="h4 mb-2 fw-bold">{{ stats()?.activeProductionOrders }}</p>
            <small class="text-muted">Orders in progress</small>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="card-title mb-0">Net Profit</h5>
              <i class="bi bi-graph-up-arrow text-primary fs-4"></i>
            </div>
            <p class="h4 mb-2 fw-bold">{{ stats()?.netProfit | currency }}</p>
            <small class="text-success">Revenue - Expenses</small>
          </div>
        </div>
      </div>
    </div>

    @if (stats()?.criticalRawMaterials?.length) {
      <div class="row mb-4">
        <div class="col-12">
          <div class="card border-0 shadow-sm border-start border-warning border-5">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between mb-3">
                <div>
                  <h5 class="card-title fw-bold text-warning-emphasis mb-1">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i> Critical Raw Materials
                  </h5>
                  <p class="text-muted small mb-0">These materials are below reorder level. Action required.</p>
                </div>
                <button class="btn btn-warning btn-sm text-white" routerLink="/purchasing/create-order">
                  <i class="bi bi-cart-plus me-1"></i> Create Purchase Order
                </button>
              </div>

              <div class="table-responsive">
                <table class="table table-sm align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Material</th>
                      <th>Current Stock</th>
                      <th>Reorder Level</th>
                      <th>Shortage</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (item of stats()?.criticalRawMaterials; track item.materialId) {
                      <tr>
                        <td class="fw-bold">{{ item.name }}</td>
                        <td class="text-danger fw-bold">{{ item.currentStock }} {{ item.unit }}</td>
                        <td class="text-muted">{{ item.reorderLevel }} {{ item.unit }}</td>
                        <td>
                          <span class="badge bg-danger-subtle text-danger border border-danger">
                            -{{ item.shortage }} {{ item.unit }}
                          </span>
                        </td>
                        <td>
                          <small class="text-danger fw-bold">Low Stock</small>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    }

    <div class="row g-4">
      
      <div class="col-12 col-lg-8">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-white border-0 pt-4 px-4">
            <h5 class="card-title fw-bold">üìà Sales Trend (Last 7 Days)</h5>
          </div>
          <div class="card-body" style="height: 350px;">
            <ngx-charts-line-chart
              [results]="salesChartData()"
              [view]="[800, 300]" 
              [scheme]="colorScheme"
              [legend]="true"
              [showXAxisLabel]="true"
              [showYAxisLabel]="true"
              [xAxis]="true"
              [yAxis]="true"
              xAxisLabel="Day"
              yAxisLabel="Revenue ($)">
            </ngx-charts-line-chart>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-white border-0 pt-4 px-4">
            <h5 class="card-title fw-bold">üçï Order Status</h5>
          </div>
          <div class="card-body" style="height: 350px;">
            <ngx-charts-pie-chart
              [results]="statusChartData()"
              [view]="[400, 300]"
              [scheme]="colorScheme"
              [doughnut]="true"
              [labels]="true"
              [legend]="false">
            </ngx-charts-pie-chart>
          </div>
        </div>
      </div>

      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-0 pt-4 px-4">
            <h5 class="card-title fw-bold">üèÜ Top Selling Products</h5>
          </div>
          <div class="card-body" style="height: 400px;">
            <ngx-charts-bar-vertical
              [results]="productsChartData()"
              [view]="[1200, 350]"
              [scheme]="colorScheme"
              [xAxis]="true"
              [yAxis]="true"
              [showXAxisLabel]="true"
              [showYAxisLabel]="true"
              xAxisLabel="Product"
              yAxisLabel="Quantity Sold">
            </ngx-charts-bar-vertical>
          </div>
        </div>
      </div>

    </div>
  }
</div>